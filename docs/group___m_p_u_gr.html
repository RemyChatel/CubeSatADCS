<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CubeSat Atitude Determination: MPU9150 Driver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CubeSat Atitude Determination
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group___m_p_u_gr.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a>  </div>
  <div class="headertitle">
<div class="title">MPU9150 Driver</div>  </div>
</div><!--header-->
<div class="contents">

<p>A drivers for the <a class="el" href="class_m_p_u9150.html" title="A drivers for the MPU9150 Inertial Measurement Unit.">MPU9150</a> Inertial Measurement Unit from InvenSense.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_p_u9150.html">MPU9150</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A drivers for the <a class="el" href="class_m_p_u9150.html" title="A drivers for the MPU9150 Inertial Measurement Unit.">MPU9150</a> Inertial Measurement Unit.  <a href="class_m_p_u9150.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>A drivers for the <a class="el" href="class_m_p_u9150.html" title="A drivers for the MPU9150 Inertial Measurement Unit.">MPU9150</a> Inertial Measurement Unit from InvenSense. </p>
<dl class="section version"><dt>Version</dt><dd>1.0 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2019 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Remy CHATEL </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>GNU Public License v3.0</dd></dl>
<h1>Description</h1>
<p>A driver for the InvenSense4s <a class="el" href="class_m_p_u9150.html" title="A drivers for the MPU9150 Inertial Measurement Unit.">MPU9150</a> Inertial Measurement Unit</p>
<p>Adapted from Kris Winer MPU9150AHRS library, <a href="https://os.mbed.com/users/onehorse/code/MPU9150AHRS/">https://os.mbed.com/users/onehorse/code/MPU9150AHRS/</a></p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="class_m_p_u9150.html" title="A drivers for the MPU9150 Inertial Measurement Unit.">MPU9150</a> </dd>
<dd>
<a class="el" href="_m_p_u9150__registers_8h_source.html">MPU9150_registers.h</a></dd></dl>
<h1>Example code</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_m_p_u9150_8h.html">MPU9150.h</a>&quot;</span></div><div class="line"></div><div class="line"><a class="code" href="class_m_p_u9150.html">MPU9150</a> imu(I2C_SDA, I2C_SCL);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> mcount = 0; <span class="comment">// Frequency divider for the magnetometer</span></div><div class="line">uint8_t MagRate = 50; <span class="comment">// set magnetometer read rate in Hz; 10 to 100 (max) Hz are reasonable values</span></div><div class="line">uint8_t acc_scale = <a class="code" href="_m_p_u9150_8h.html#a809d38a83bb0293b913cb890cafd82a8a93154da7a495cfb3b9ab29d2d5d4891b">AFS_2G</a>;</div><div class="line">uint8_t gyr_scale = <a class="code" href="_m_p_u9150_8h.html#a56b5f26fc75e706b7513b8bac0006980a18297ef630f6920f812695549cc2262b">GFS_250DPS</a>;</div><div class="line"><span class="keywordtype">float</span> val_acc[3], val_gyr[3], val_mag[3];</div><div class="line"></div><div class="line"><span class="comment">//--------------------- INIT ---------------------//</span></div><div class="line">pc-&gt;printf(<span class="stringliteral">&quot;\n\r\n\r\n\r\n\r\n\r\n\r--------------------------------------\n\r&quot;</span>);</div><div class="line">pc-&gt;printf(<span class="stringliteral">&quot;Connection ok\n\r&quot;</span>);</div><div class="line">uint8_t whoami = imu.readByte(<a class="code" href="_m_p_u9150_8h.html#a918c48fc034885089b181da782294c63">MPU9150_ADDRESS</a>, WHO_AM_I_MPU9150);  <span class="comment">// Read WHO_AM_I register for MPU-9150</span></div><div class="line">pc-&gt;printf(<span class="stringliteral">&quot;I AM 0x%x\n\r&quot;</span>, whoami); pc-&gt;printf(<span class="stringliteral">&quot;I SHOULD BE 0x68 or 0x73\n\r&quot;</span>);</div><div class="line"><span class="keywordflow">if</span> (!imu.initIMU(acc_scale, gyr_scale)) {   <span class="comment">// WHO_AM_I should be 0x68</span></div><div class="line">    pc-&gt;printf(<span class="stringliteral">&quot;Could not connect to MPU9150: \n\r&quot;</span>);</div><div class="line">    <span class="keywordflow">while</span>(1) ; <span class="comment">// Loop forever if communication doesn&#39;t happen</span></div><div class="line">}</div><div class="line"></div><div class="line">imu.recalibrateIMU(1000, 100);</div><div class="line"><span class="keywordtype">float</span> null_avg[3] = {0,0,0};</div><div class="line">imu.setAvgAcc(null_avg);</div><div class="line">imu.setAvgMag(null_avg);</div><div class="line">pc-&gt;printf(<span class="stringliteral">&quot;IMU ok\n\r&quot;</span>);</div><div class="line"></div><div class="line"><span class="keywordflow">while</span>(1){</div><div class="line">    last_update = t-&gt;read_us();</div><div class="line"></div><div class="line">    <span class="comment">//--------------------- LOOP ---------------------//</span></div><div class="line">    <span class="keywordflow">if</span>(imu.readByte(<a class="code" href="_m_p_u9150_8h.html#a918c48fc034885089b181da782294c63">MPU9150_ADDRESS</a>, INT_STATUS) &amp; 0x01) {  <span class="comment">// On interrupt, check if data ready interrupt</span></div><div class="line">        imu.getAccel(val_acc);  <span class="comment">// Read the x/y/z adc values</span></div><div class="line">        imu.getGyro(val_gyr);  <span class="comment">// Read the x/y/z adc values</span></div><div class="line">        sun.getSunVector(rsun_b);</div><div class="line">        </div><div class="line">        mcount++;</div><div class="line">        <span class="keywordflow">if</span> (mcount &gt; 200/MagRate) {  <span class="comment">// this is a poor man&#39;s way of setting the magnetometer read rate (see below) </span></div><div class="line">            imu.getMag(val_mag);  <span class="comment">// Read the x/y/z adc values</span></div><div class="line">            mcount = 0;</div><div class="line">        }</div><div class="line"></div><div class="line">        pc-&gt;printf(<span class="stringliteral">&quot;Acc (mg):  &quot;</span>);</div><div class="line">        pc-&gt;printf(<span class="stringliteral">&quot;{% 4.2f, % 4.2f, % 4.2f}\n\r&quot;</span>, val_acc[0]*1000, val_acc[1]*1000, val_acc[2]*1000);</div><div class="line">        pc-&gt;printf(<span class="stringliteral">&quot;Gyr (°/s): &quot;</span>);</div><div class="line">        pc-&gt;printf(<span class="stringliteral">&quot;{% 4.2f, % 4.2f, % 4.2f}\n\r&quot;</span>, val_gyr[0], val_gyr[1], val_gyr[2]);</div><div class="line">        pc-&gt;printf(<span class="stringliteral">&quot;Mag (uT):  &quot;</span>);</div><div class="line">        pc-&gt;printf(<span class="stringliteral">&quot;{% 4.2f, % 4.2f, % 4.2f}\n\r&quot;</span>, val_mag[0], val_mag[1], val_mag[2]);</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h1>License</h1>
<p><b>(C) Copyright 2019 Remy CHATEL</b></p>
<p>Licensed Under GPL v3.0 License <a href="http://www.gnu.org/licenses/gpl-3.0.html">http://www.gnu.org/licenses/gpl-3.0.html</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
