<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CubeSat Atitude Determination: Estimators</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CubeSat Atitude Determination
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group___estimators_gr.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Estimators</div>  </div>
</div><!--header-->
<div class="contents">

<p>A library for attitude estimators given a set of atitude measurements.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga4b071fa4bda8225098b5806ea45f8cb6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___estimators_gr.html#ga4b071fa4bda8225098b5806ea45f8cb6">Estimators::QUEST</a> (float quat[4], int N, float **s_eci, float **s_body, float *omega, float tolerance)</td></tr>
<tr class="memdesc:ga4b071fa4bda8225098b5806ea45f8cb6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the quaternion estimate from the QuEst Algorithm.  <a href="group___estimators_gr.html#ga4b071fa4bda8225098b5806ea45f8cb6">More...</a><br /></td></tr>
<tr class="separator:ga4b071fa4bda8225098b5806ea45f8cb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5f10766fb1abd03a0d32e21e671f83d7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___estimators_gr.html#ga5f10766fb1abd03a0d32e21e671f83d7">Estimators::QUEST</a> (<a class="el" href="class_matrix.html">Matrix</a> *quat, int N, <a class="el" href="class_matrix.html">Matrix</a> *s_eci, <a class="el" href="class_matrix.html">Matrix</a> *s_body, float *omega, float tolerance)</td></tr>
<tr class="memdesc:ga5f10766fb1abd03a0d32e21e671f83d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the quaternion estimate from the QuEst Algorithm.  <a href="group___estimators_gr.html#ga5f10766fb1abd03a0d32e21e671f83d7">More...</a><br /></td></tr>
<tr class="separator:ga5f10766fb1abd03a0d32e21e671f83d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>A library for attitude estimators given a set of atitude measurements. </p>
<dl class="section version"><dt>Version</dt><dd>1.0 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2019 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Remy CHATEL </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>GNU Public License v3.0</dd></dl>
<h1>Description</h1>
<h2>Quick overview</h2>
<p>In order to determine the attitude of a satellite, it is useful to fuse the output of multiple sensors to increase accuracy.</p>
<p>This library provides estimators algorithm that returns the rotation quaternion using multiple sensors.</p>
<p>The QuEst (Quaternion Estimator) algorithm is a way of solving Wahba's problem:</p>
<p>If we have a set of measurements in the body frame and a set of the same measurememts in an inertial frame, then we can try to find the optimal rotation that links best each pair of body-inertial measurements.</p>
<p>The QuEst algorithm works by finding an optimal eigen value for the combined measurement matrix, using a Newton solver.</p>
<h2>Detailed description</h2>
<p>Now that both body frame measurements and ECI frame theoretical vectors are available, the rotation that links each pair can be estimated:</p>
<p class="formulaDsp">
\begin{equation} \hat{\mathbf{s}}_{b k}=\mathbf{C}_{b a} \hat{\mathbf{s}}_{a k} \end{equation}
</p>
<p>where \(\hat{\mathbf{s}}_{b k}\) is the measurement in the body frame, \(\hat{\mathbf{s}}_{a k}\) is the model in the ECI frame and \(\mathbf{C}_{b a}\) is the rotation matrix between the two.</p>
<p>The \(\mathbf{C}_{b a}\) would supposedly unique if the measurement were noiseless and accurate as well as if the model is perfect. The goal is therefore to find the rotation that would fit best all the vector pairs.</p>
<p>This problem can be looked at as the following optimization problem, called <em>Whaba's problem</em></p>
<p class="formulaDsp">
\begin{equation} J\left(\mathbf{C}_{b a}\right) = \frac{1}{2} \sum_{k=1}^{N} w_{k}\left(\hat{\mathbf{s}}_{b k}-\mathbf{C}_{b a} \hat{\mathbf{s}}_{a k}\right)^{T}\left(\hat{\mathbf{s}}_{b k}-\mathbf{C}_{b a} \hat{\mathbf{s}}_{a k}\right) \end{equation}
</p>
<p>and in term of quaternion, with \( B = \left(\sum_{k=1}^{N} w_{k} \hat{\mathbf{s}}_{a k} \hat{\mathbf{s}}_{b k}^{T}\right)^T \):</p>
<p class="formulaDsp">
\begin{equation} \hat{J}(\mathbf{q})=\left[\begin{array}{cc}{\eta} &amp; {\epsilon^{T}}\end{array}\right] \underbrace{\left[\begin{array}{cc}{\mathbf{K}_{11}} &amp; {\mathbf{k}_{12}} \\ {\mathbf{k}_{12}^{T}} &amp; {k_{22}}\end{array}\right]}_{\mathbf{K}} \underbrace{\left[\begin{array}{l} {\eta} \\ {\epsilon} \end{array}\right]}_{\mathbf{q}} \end{equation}
</p>
<p>where \( k_{22} = tr( \mathbf{B} ) \) , \( \mathbf{K}_{11} = \mathbf{B} + \mathbf{B}^T - k_{22}\mathbf{1} \) and \( \mathbf{k}_{12}=\left[\left(B_{23}-B_{32}\right)\left(B_{31}-B_{13}\right)\left(B_{12}-B_{21}\right)\right]^{T} \) .</p>
<p>After some derivation, the QuEst (Quaternion Estimator) algorithm can be found. This algorithm solves the optimization function by finding the maximum eigenvalue of \( \mathbf{K}\) . The resulting eigenvector will be the best quaternion of the optimization problem.</p>
<p>In order to avoid solving explicitly for the eigenvalue, which is a computationally-intensive process, the QuEst algorithm uses Newton's method to compute a reasonable approximation of the eigenvalue, then calculate the eigenvector. For that, it needs an initial value to converge in the right direction.</p>
<p>See <em>Spacecraft dynamics and control: An introduction</em> for the full derivation of the implemented algorithm.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group___estimators_gr.html#ga4b071fa4bda8225098b5806ea45f8cb6" title="Return the quaternion estimate from the QuEst Algorithm.">Estimators::QUEST</a></dd></dl>
<h1>Example code</h1>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="_estimators_8test_8cpp.html" title="Source code for Estimators.test.h.">Estimators.test.cpp</a></dd></dl>
<h1>References</h1>
<p>[1] "Spacecraft Dynamics and Control An Introduction" by de Ruiter, Damaren and Forbes</p>
<h1>Dependencies</h1>
<p>This library depends on the "Matrix" library that can be found here: <a href="https://github.com/RemyChatel/">https://github.com/RemyChatel/</a> In turn this library relies on &lt;std::cmath&gt; and &lt;std::vector&gt;</p>
<dl class="section attention"><dt>Attention</dt><dd>This library uses float only (NOT double) and therefore expect 6 to 7 significant figures</dd></dl>
<h1>License</h1>
<p><b>(C) Copyright 2019 Remy CHATEL</b></p>
<p>Licensed Under GPL v3.0 License <a href="http://www.gnu.org/licenses/gpl-3.0.html">http://www.gnu.org/licenses/gpl-3.0.html</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga4b071fa4bda8225098b5806ea45f8cb6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4b071fa4bda8225098b5806ea45f8cb6">&#9670;&nbsp;</a></span>QUEST() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Estimators::QUEST </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>quat</em>[4], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>N</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>s_eci</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>s_body</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>omega</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>tolerance</em> = <code>1e-5</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the quaternion estimate from the QuEst Algorithm. </p>
<p>Algorithm from "Spacecraft Dynamics and Control An Introduction" by de Ruiter, Damaren and Forbes</p>
<p>This method compute the quaternion of the rotation between the spacecraft body frame and the Earth Centered Inertial frame using a set of N sensors using the QuEst algorithm.</p>
<p>Each sensor should provide the measurement in the spacecraft body frame, while models/data should provide the measurement in the ECI frame. Each sensor is weighted according to the quality of its output (usually, omega = 1 / (sigma^2), with sigma^2 the variance of the output.</p>
<p>The quaternion return follow the format [x, y, z, eta] with eta the scalar part and x, y, z the vector components.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">quat</td><td>The quaternion to update [x, y, z, eta] </td></tr>
    <tr><td class="paramname">N</td><td>The number of measurements </td></tr>
    <tr><td class="paramname">s_eci</td><td>A pointer to N 3-element array (the vectors) of the normalized models in the ECI frame [x, y, z] </td></tr>
    <tr><td class="paramname">s_body</td><td>A pointer to N 3-element array (the vectors) of the normalized measurements in the satellite body frame [x, y, z] </td></tr>
    <tr><td class="paramname">omega</td><td>An N-element array containing the weight of each measurement </td></tr>
    <tr><td class="paramname">tolerance</td><td>The tolerance of Newton's optimization problem (default is 1e-5) </td></tr>
  </table>
  </dd>
</dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group___estimators_gr_ga4b071fa4bda8225098b5806ea45f8cb6_cgraph.png" border="0" usemap="#group___estimators_gr_ga4b071fa4bda8225098b5806ea45f8cb6_cgraph" alt=""/></div>
<map name="group___estimators_gr_ga4b071fa4bda8225098b5806ea45f8cb6_cgraph" id="group___estimators_gr_ga4b071fa4bda8225098b5806ea45f8cb6_cgraph">
<area shape="rect"  title="Return the quaternion estimate from the QuEst Algorithm." alt="" coords="5,5,143,32"/>
<area shape="rect"  href="class_matrix.html#aa7bf588d788d601548a34030e59152b4" title="Creates a matrix of a given size filled with zeros." alt="" coords="191,5,289,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group___estimators_gr_ga4b071fa4bda8225098b5806ea45f8cb6_icgraph.png" border="0" usemap="#group___estimators_gr_ga4b071fa4bda8225098b5806ea45f8cb6_icgraph" alt=""/></div>
<map name="group___estimators_gr_ga4b071fa4bda8225098b5806ea45f8cb6_icgraph" id="group___estimators_gr_ga4b071fa4bda8225098b5806ea45f8cb6_icgraph">
<area shape="rect"  title="Return the quaternion estimate from the QuEst Algorithm." alt="" coords="176,31,313,57"/>
<area shape="rect"  href="class_a_d_s_core.html#a8d16f3419b12b7891a00ed824cd2673a" title="Updates the attitude of the spacecraft by combining the output the different sensors and filtering th..." alt="" coords="5,5,128,32"/>
<area shape="rect"  href="_estimators_8test_8h.html#ae5db03befd0604bd8758a8c0b429d9fe" title="Test of the Estimators module." alt="" coords="25,56,108,83"/>
</map>
</div>

</div>
</div>
<a id="ga5f10766fb1abd03a0d32e21e671f83d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5f10766fb1abd03a0d32e21e671f83d7">&#9670;&nbsp;</a></span>QUEST() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Estimators::QUEST </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_matrix.html">Matrix</a> *&#160;</td>
          <td class="paramname"><em>quat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>N</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_matrix.html">Matrix</a> *&#160;</td>
          <td class="paramname"><em>s_eci</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_matrix.html">Matrix</a> *&#160;</td>
          <td class="paramname"><em>s_body</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>omega</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>tolerance</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the quaternion estimate from the QuEst Algorithm. </p>
<p>Algorithm from "Spacecraft Dynamics and Control An Introduction" by de Ruiter, Damaren and Forbes</p>
<p>This method compute the quaternion of the rotation between the spacecraft body frame and the Earth Centered Inertial frame using a set of N sensors using the QuEst algorithm.</p>
<p>Each sensor should provide the measurement in the spacecraft body frame, while models/data should provide the measurement in the ECI frame. Each sensor is weighted according to the quality of its output (usually, omega = 1 / (sigma^2), with sigma^2 the variance of the output.</p>
<p>The quaternion return follow the format [x, y, z, eta] with eta the scalar part and x, y, z the vector components.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">quat</td><td>The quaternion to update [x, y, z, eta] </td></tr>
    <tr><td class="paramname">N</td><td>The number of measurements </td></tr>
    <tr><td class="paramname">s_eci</td><td>An array of N normalized models in the ECI frame [x, y, z] </td></tr>
    <tr><td class="paramname">s_body</td><td>An array of N normalized measurements in the satellite body frame [x, y, z] </td></tr>
    <tr><td class="paramname">omega</td><td>An N-element array containing the weight of each measurement </td></tr>
    <tr><td class="paramname">tolerance</td><td>The tolerance of Newton's optimization problem (default is 1e-5) </td></tr>
  </table>
  </dd>
</dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group___estimators_gr_ga5f10766fb1abd03a0d32e21e671f83d7_cgraph.png" border="0" usemap="#group___estimators_gr_ga5f10766fb1abd03a0d32e21e671f83d7_cgraph" alt=""/></div>
<map name="group___estimators_gr_ga5f10766fb1abd03a0d32e21e671f83d7_cgraph" id="group___estimators_gr_ga5f10766fb1abd03a0d32e21e671f83d7_cgraph">
<area shape="rect"  title="Return the quaternion estimate from the QuEst Algorithm." alt="" coords="5,119,143,145"/>
<area shape="rect"  href="class_matrix.html#a12d963dd26d135bdd197cac54ae6bdaf" title="Compute the norm of an (n x 1) or (1 x n) vector." alt="" coords="191,43,285,69"/>
<area shape="rect"  href="class_matrix.html#a8b75c0669091bb9ebc51b727f70f2d5f" title="Returns the dot Product of any two same leght vectors. In this case a vector is defined as a [1,..." alt="" coords="341,93,425,120"/>
<area shape="rect"  href="class_matrix.html#ad0c96cdea0d2ae3403653ca90aa70796" title="Transposes Matrix, return new Object." alt="" coords="480,144,607,171"/>
<area shape="rect"  href="class_matrix.html#a89e843f74660aabb9b6403a738b6ee42" title="Creates a square identity matrix of a given size." alt="" coords="195,195,281,221"/>
<area shape="rect"  href="class_matrix.html#a88e35a3795f98d4cb63f01c647024996" title="Determines weather a Matrix is a Single Column or Row." alt="" coords="486,5,601,32"/>
<area shape="rect"  href="class_matrix.html#af698f665522164d4c3961120c94ff080" title="Returns the sum of every cell in the Matrix." alt="" coords="498,81,589,108"/>
<area shape="rect"  href="class_matrix.html#aa7bf588d788d601548a34030e59152b4" title="Creates a matrix of a given size filled with zeros." alt="" coords="333,195,432,221"/>
<area shape="rect"  href="class_matrix.html#a7e960a1c6e8f5aa90dddb18d9394890c" title="Provide the size of the matrix." alt="" coords="337,245,428,272"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
